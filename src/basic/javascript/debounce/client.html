<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>防抖</title>
        <script>
            function axios(url) {
                return new Promise(resolve => ajax(url, function(res) {
                    resolve(res)
                }));
            }

            function ajax(url, success, error) {
                var request = new XMLHttpRequest();
                request.open('GET', url);
                request.send();
                request.onreadystatechange = function() {
                    if (request.readyState === 4) {
                        if (request.status === 200) {
                            success(request.response)
                        }
                    }
                }
        }
        </script>
    </head>
    <body>
        <h2>点击按钮请求防抖</h2>
        <button class="debounce-btn">+1</button>
        <h2>点击按钮请求节流</h2>
        <button class="throttle-btn">+1</button>
        <h2>count:</h2>
        <div class="count">0</div>
        <h2>data:</h2>
        <div class="count-data"></div>

        <script>
            var count = 0;
            var oDebounceBtns = document.getElementsByClassName('debounce-btn');
            var oThrottleBtns = document.getElementsByClassName('throttle-btn');
            var oCounts = document.getElementsByClassName('count');
            var oCountDatas = document.getElementsByClassName('count-data');
            var oInputs = document.getElementsByClassName('input');
            var oInputMsgs = document.getElementsByClassName('input-message');
            var oCount = oCounts.length && oCounts[0];
            var oCountData = oCountDatas.length && oCountDatas[0];

            if (oDebounceBtns.length) {
                oDebounceBtns[0].addEventListener('click', __debounce(onClick, 2000), false)
            }

            if (oThrottleBtns.length) {
                oThrottleBtns[0].addEventListener('click', __throttle(onClick, 2000), false)
            }
            
            async function onClick() {
                count++;
                oCount.textContent = count;

                oCountData.innerHTML = 'loading...';

                const res = await axios(`/data?count=${count}`);
                oCountData.innerHTML = res;
            }

            // 防抖函数
            function __debounce(fn, timeInstance) {
                var timer = null;
                return function() {
                    if (timer) {
                        clearTimeout(timer);
                    }
                    timer = setTimeout(() => {
                        fn.apply(this, arguments);
                    }, timeInstance);
                }
            }

            function __throttle() {}
        </script>
    </body>
</html>